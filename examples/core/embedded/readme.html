<html>
  <head>
    <title>HornetQ Embedded Example</title>
    <link rel="stylesheet" type="text/css" href="../../common/common.css">
  </head>
  <body>
     <h1>Embedded Example</h1>
     <br>
     <p>This examples shows how to setup and run HornetQ embedded.</p>
     <p>HornetQ was designed to use POJOs (Plain Old Java Objects), what makes embedding HornetQ as simple as instantiating a few objects.</p>
     <p>On this example, we are only using one jar (hornetq-core.jar).</p>
     
     <p>HornetQ Embedded could be used from very simple use cases with only InVM support to very complex cases with clustering, persistence and fail over.</p>
     <br>
     <h2>Example step-by-step</h2>     
     <p><i>To run the example, simply type <code>ant</code> from this directory</i></p>
     <p>In this we don't use any configuration files. (Everything is embedded). We simply instantiate ConfigurationImpl, HornetQServer, start it and operate on JMS regularly</p>
     <br>
     <ol>
        <li>Create the Configuration, and set the properties accordingly</li>
        <pre>
         <code>Configuration configuration = new ConfigurationImpl();
         configuration.setEnablePersistence(false);
         configuration.setSecurityEnabled(false);
         configuration.getAcceptorConfigurations().add(new TransportConfiguration(InVMAcceptorFactory.class.getName()));
         </code></pre>
         
        <li>Create and start the server</li>
        <pre>
           <code>HornetQServer server = Messaging.newHornetQServer(configuration);</code>
           <code>server.start();</code></pre>

        <li>As we are not using a JNDI environment we instantiate the objects directly</li>
        <pre>
           <code>ClientSessionFactory sf = new ClientSessionFactoryImpl (new TransportConfiguration(InVMConnectorFactory.class.getName()));</code>
        </pre>

        <li>Create a Core Queue</li>
        <pre>
           <code>
         ClientSession coreSession = sf.createSession(false, false, false);
         final String queueName = "queue.exampleQueue";
         coreSession.createQueue(queueName, queueName, true);
         coreSession.close();
        </pre>

        <li>Create the session and producer</li>
        <pre>
           <code>
            session = sf.createSession();
                                   
            ClientProducer producer = session.createProducer(queueName);
            </code>
        </pre>

        <li>Create and send a Message</li>
        <pre><code>
            ClientMessage message = session.createClientMessage(false);
            message.putStringProperty(propName, "Hello sent at " + new Date());
            System.out.println("Sending the message.");
            producer.send(message);
       </code></pre>

        <li>Create the message consumer and start the connection</li>
        <pre><code>
            ClientConsumer messageConsumer = session.createConsumer(queueName);
            session.start();</code></pre>

        <li>Receive the message</li>
        <pre><code>
            ClientMessage messageReceived = messageConsumer.receive(1000);
            System.out.println("Received TextMessage:" + messageReceived.getProperty(propName));</code></pre>

        <li>Be sure to close our resources!</li>

        <pre>
           <code>
           finally
           {
              if (connection != null)
              {
                 connection.close();
              }
           }</code>
        </pre>

        <li>Stop the server</li>

        <pre>
           <code>
           server.stop();
		   </code>
        </pre>
     </ol>
  </body>
</html>